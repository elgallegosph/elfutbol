<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El F√∫tbol - Gesti√≥n Pro</title>
    <style>
        :root { --primary: #1a5276; --success: #27ae60; --danger: #c0392b; }
        body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 10px; }
        body.modo-visitante .solo-admin { display: none !important; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        input, select, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .grupo-caja { border: 2px solid var(--primary); padding: 10px; margin-top: 10px; border-radius: 5px; }
    </style>
</head>
<body class="modo-visitante" id="mainBody">

<div class="container">
    <h1>üèÜ Gesti√≥n de Torneo</h1>
    <div id="txtEstado" style="text-align: center; font-weight: bold; margin-bottom: 20px;">MODO VISITANTE</div>

    <section class="solo-admin">
        <div class="grid">
            <div>
                <h3>1. Registrar Equipo</h3>
                <input type="text" id="nombreEquipo" placeholder="Nombre Equipo">
                <button onclick="registrarEquipo()">A√±adir Equipo</button>
            </div>
            <div>
                <h3>2. Jugadores</h3>
                <select id="selEq"></select>
                <input type="text" id="nombreJug" placeholder="Nombre Jugador">
                <input type="tel" id="telJug" placeholder="Tel√©fono">
                <button onclick="registrarJugador()">A√±adir Jugador</button>
            </div>
        </div>
        <hr>
        <button onclick="realizarSorteo()" style="background: var(--success);">üé≤ Realizar Sorteo de Grupos</button>
    </section>

    <div id="displayGrupos" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;"></div>

    <div id="authPanel" style="margin-top: 40px; padding: 20px; border: 1px solid #ddd; background: #fafafa;">
        <div id="auth-inputs">
            <h3>üîê Iniciar Sesi√≥n / Registrarse</h3>
            <input type="email" id="email" placeholder="Correo">
            <input type="password" id="password" placeholder="Contrase√±a">
            <div style="display: flex; gap: 10px;">
                <button onclick="login()">Entrar</button>
                <button onclick="register()" style="background: #7f8c8d;">Crear Cuenta</button>
            </div>
        </div>
        <div id="admin-ui" style="display:none; text-align: center;">
            <p>Admin: <b id="userEmail"></b></p>
            <button onclick="publicarTorneo()" style="background: var(--success);">üíæ Guardar en Firebase</button>
            <button onclick="logout()" style="background: var(--danger);">Salir</button>
        </div>
    </div>
</div>

<script>
    let dbT = JSON.parse(localStorage.getItem('futbol_local')) || { equipos: [], grupos: {} };

    window.registrarEquipo = function() {
        const n = document.getElementById('nombreEquipo').value;
        if(!n) return;
        dbT.equipos.push({ nombre: n, jugadores: [] });
        guardarYRender();
    };

    window.registrarJugador = function() {
        const eqN = document.getElementById('selEq').value;
        const jugN = document.getElementById('nombreJug').value;
        const tel = document.getElementById('telJug').value;
        const eq = dbT.equipos.find(e => e.nombre === eqN);
        if(eq) eq.jugadores.push({ nombre: jugN, tel });
        guardarYRender();
    };

    window.realizarSorteo = function() {
        dbT.grupos = { "Grupo A": [], "Grupo B": [] };
        const eqs = [...dbT.equipos].sort(() => Math.random() - 0.5);
        eqs.forEach((e, i) => {
            const g = i % 2 === 0 ? "Grupo A" : "Grupo B";
            dbT.grupos[g].push(e.nombre);
        });
        guardarYRender();
    };

    function guardarYRender() {
        localStorage.setItem('futbol_local', JSON.stringify(dbT));
        render();
    }

    function render() {
        document.getElementById('selEq').innerHTML = dbT.equipos.map(e => `<option value="${e.nombre}">${e.nombre}</option>`).join('');
        document.getElementById('displayGrupos').innerHTML = Object.keys(dbT.grupos).map(k => `
            <div class="grupo-caja"><h3>${k}</h3>${dbT.grupos[k].map(n => `<p>‚öΩ ${n}</p>`).join('')}</div>
        `).join('');
    }

    window.cambiarModo = function(user) {
        const body = document.getElementById('mainBody');
        const ai = document.getElementById('auth-inputs');
        const au = document.getElementById('admin-ui');
        if(user) {
            body.classList.remove('modo-visitante');
            ai.style.display = "none"; au.style.display = "block";
            document.getElementById('userEmail').innerText = user.email;
            document.getElementById('txtEstado').innerText = "‚ö° MODO ADMINISTRADOR";
        } else {
            body.classList.add('modo-visitante');
            ai.style.display = "block"; au.style.display = "none";
            document.getElementById('txtEstado').innerText = "üëÅÔ∏è MODO VISITANTE";
        }
    };
    window.onload = render;
</script>
<script type="module" src="app.js"></script>
</body>
</html>
